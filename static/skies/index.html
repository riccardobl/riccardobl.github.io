<html>

<head>
    <title>SkyTest</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photo-sphere-viewer@4/dist/photo-sphere-viewer.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/three/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uevent@2/browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/photo-sphere-viewer@4/dist/photo-sphere-viewer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/photo-sphere-viewer@4/dist/adapters/cubemap.js"></script>
    <style>
        body{
            text-align: center;
            background-color: rgb(32, 32, 32);
            color:rgb(124, 124, 124);

        }
        #skies{
            flex-wrap: wrap;
            display:flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
        }
        #viewer{
            margin:auto;
        }

        figure{
            cursor: pointer;
            display: inline-block;
            margin:0vw;
        }
        figure img{
            width: 25vw;
            height:25vw;
            max-width:15em;
            max-height:15em;

        }
        figcaption{
            background:black;
            
            font-weight: bold;
            width:100%;

            
            

        }
        #viewer{
            max-width:80vw;
            max-height:100vh;
        }
    </style>
    <script>
        var SKY_ID=1;
        async function exists(resource){
            try{
                let res = await fetch(resource, { method: 'HEAD' });
                return res.ok;
            }catch(e){
                return false;
            }
        }

        async function loadSky(){
            const skyPath=`./sky${SKY_ID}`
            const previews=[`${skyPath}/preview.png`,`${skyPath}/env.png`,`${skyPath}/pz.png`];
            for(let preview of previews){
                if(await exists(preview)){
                    const container=document.querySelector("#skies");

                    const previewEl = document.createElement("img");
                    previewEl.src=preview;

                    
                    const caption=document.createElement("figcaption");
                    caption.innerText=`Sky ${SKY_ID}`;

                    const figureEl=document.createElement("figure");
                    figureEl.appendChild(previewEl);
                    figureEl.appendChild(caption);
                    container.appendChild(figureEl);

                    previewEl.addEventListener("click", async () => {
                        const isCube = await exists(`${skyPath}/px.png`);
                        const viewerContainer = document.querySelector('#viewer');
                        viewerContainer.innerHTML = "";

                        if (isCube) {
                            const viewer = new PhotoSphereViewer.Viewer({
                                container: viewerContainer,
                                adapter: PhotoSphereViewer.CubemapAdapter,
                                panorama: {
                                    left: `${skyPath}/px.png`,
                                    front: `${skyPath}/nz.png`,
                                    right: `${skyPath}/nx.png`,
                                    back: `${skyPath}/pz.png`,
                                    top: `${skyPath}/ny.png`,
                                    bottom: `${skyPath}/py.png`,
                                },
                            });
                        } else {
                            const viewer = new PhotoSphereViewer.Viewer({
                                container: viewerContainer,
                                panorama: `${skyPath}/env.png`,
                            });
                        }
                        
                        viewerContainer.scrollIntoView({behavior: "smooth", block: "center", inline: "nearest"});
                    });
                }
            }

            SKY_ID++;

            return SKY_ID<32;
            

          
        }

        async function loadSkies(){
            if(await loadSky()){
                setTimeout(loadSkies,100);
            }

        }

        function main(){
            const container=document.querySelector("#skies");
            container.innerHTML="";
            loadSkies();
        }


        
        document.addEventListener("DOMContentLoaded", main);


    </script>
</head>

<body >
    <h1>Skies generated by AI</h1>
    <h2>Just testing some stuff...</h2>
    <h3>Click to open...</h3>
    <div id="skies"></div>
    <div id="viewer" ></div>

    

</body>

</html>